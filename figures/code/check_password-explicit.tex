% !TEX root = ../../master.tex

\begin{lstlisting}[float, style=dlmc, numbers=left, caption={Labelled password checker example}, label=example:code:check_password-explicit]
#include <stdbool.h>
#include <string.h>

principal u, pc;

typedef struct user_info {
  char username[20];
  char password[20];
} user_info;

user_info {{u->}} get_login();
user_info {{pc->}} *get_users();
void {{output->u}} send_response(bool is_match);

bool {{u->u}} check_password(char {{u->}} *username,
    char {{u->}} *password) {
  int (*@\fadedlbl{pc->}@*) user_count = 100;
  user_info (*@\fadedlbl{pc->}@*) *users = get_users();
  int (*@\fadedlbl{pc->}@*) i = 0;
  bool (*@\fadedlbl{u->;pc->}@*) match = false;

  while (i < user_count) {
    if (!strcmp(users[i].username, username) &&
        !strcmp(users[i].password, password)) {
      match = true;
    }
    i = i + 1;
  }

  this -->? u, pc {
    return <|match, (*@\fadedlbl{u->u}@*)|>;
  }
}

int main(int argc, char **argv) {
  user_info (*@\fadedlbl{u->}@*) login = get_login();
  bool (*@\fadedlbl{u->u}@*) is_match = check_password(login.username,
      login.password);
  send_response(is_match);
}
\end{lstlisting}

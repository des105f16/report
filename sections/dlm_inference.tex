% !TEX root = ../master.tex

\section{Inference Algorithm}

\subsection{Abstract syntax}

\begin{gather*}
  P \in \iProg\\
  D_V \in \iDecv\\
  x \in \iVar\\
  D_F \in \iDecf \\
  f \in \iFun\\
  D_P \in \iDecp\\
  p \in \iVar\\
  S \in \iStm\\
  S_C \in \iStmc\\
  l \in \mathbb{L}\\
\end{gather*}
\begin{align*}
  P       & ::= D_S \gp D_V \gp D_F \gp P \; P\\
  D_S     & ::= struuucts\\
  D_V     & ::= T \, l \, x \, [\tk = e] \tk ;\\
  D_F     & ::= T \, l \, f \tk ( D_P \tk ) S\\
  D_P     & ::= T \, l \, p \gp D_{P_1} \tk , D_{P_2} \gp \epsilon\\
  S       & ::= S_C \gp S_1 \tk ; S_2 \gp other \; statements\\
  S_C     & ::= \tk{while} \tk ( e \tk ) S \gp \tk{if} \tk ( e \tk ) S \gp \tk{if} \tk ( e \tk ) S_1 \tk{else} S_2\\
  e       & ::= e_d \gp other \; expressions\\
  e_d     & ::= \tk{<|} e \, [\tk , l] \tk{|>}
\end{align*}

\subsection{Semantics for determining labels}
The label environment is called $\iLbl$ and is defined by:
\[
  \iLbl = \iVar \cup \iFun \cup \iStmc \cup \iExpd \rightharpoonup \mathbb{L}
\]
Where $\mathbb{L}$ is the set of labels.
There are five types of labels:
\begin{enumerate}
  \item Policy labels -- like those described earlier
  \item Variable labels -- denoted $\vlbl{x}$
  \item Constant labels -- denoted $\clbl{p}$
  \item Lower bound -- denoted $\bot$
  \item Upper bound -- denoted $\top$
  \item Join/meet labels -- combinations of the above-mentioned labels
\end{enumerate}

\subsubsection{Transision system}
$(\Gamma_{L}, \rightarrow_{L}, T_{L})$, with
\begin{align*}
  \Gamma_{L} & = (\iDecv \times \iLbl) \cup (\iDecf \times \iLbl) \cup (\iDecp \times \iLbl) \cup (\iStmc \times \iLbl) \cup (\iExpd \times \iLbl) \cup \iLbl \\
  T_{L} & = \iLbl
\end{align*}

\subsubsection{Variable declarations}

\begin{trules}
  \trule{VAR-DECL-EXPL}
        {\argpart {T \, l \, x, lbl} {L} {lbl'} }
        {\argpart {D_V, lbl[x \mapsto l]} {L} {lbl'} }
        {where $l \in \mathbb{L}$}
  \trule{VAR-DECL-IMPL}
        {\argpart {T \, l \, x, lbl} {L} {lbl'} }
        {\argpart {D_V, lbl[x \mapsto \vlbl{x}]} {L} {lbl'} }
        {where $l = \epsilon$}
\end{trules}

\subsubsection{Function declarations}

\begin{trules}
  \trule{FUN-DECL-EXPL}
        {\argpart {T \, l \, f \tk ( D_P \tk ) S, lbl} {L} {lbl'} }
        {\argpart {D_P, lbl} {L} {lbl''} \;\; \argpart {D_F, lbl''[f \mapsto l, b \mapsto \bot]} {L} {lbl'} }
        {where $l \in \mathbb{L}$}
  \trule{FUN-DECL-IMPL}
        {\argpart {T \, l \, f \tk ( D_P \tk ) S, lbl} {L} {lbl'} }
        {\argpart {D_P, lbl} {L} {lbl''} \; \argpart {D_F, lbl''[f \mapsto l', b \mapsto \bot]} {L} {lbl'} }
        {where $l = \epsilon$\\
        and $P = D_P \rightarrow (p_1, p_2, \dots, p_n)$\\
        and $l' = \sqcupl\limits_{p \in P} lbl \, p$}
  \trule{PAR-DECL-EXPL}
        {\argpart {T \, l \, p, lbl} {L} {lbl'} }
        {\argpart {D_P, lbl[p \mapsto l]} {L} {lbl'} }
        {where $l \in \mathbb{L}$}
  \trule{PAR-DECL-IMPL}
        {\argpart {T \, l \, p, lbl} {L} {lbl'} }
        {\argpart {D_P, lbl[p \mapsto \clbl{p}]} {L} {lbl'} }
        {where $l = \epsilon$}
  \trule{EMPTY-PAR-DECL}
        {\argpart {\epsilon, lbl} {L} {lbl} }
        {}
        {}
\end{trules}

\subsubsection{Conditional statements}

\begin{trules}
  \trule{WHILE-STM}
        {\argpart {\tk{while} \tk ( e \tk ) S, lbl} {L} {lbl'} }
        {\argpart {S_C, lbl[while_i \mapsto l, b \mapsto b']} {L} {lbl''} \; \argpart{S, lbl''} {L} {lbl'} }
        {where $lbl \vdash e \rightarrow_L l$\\
          and $b' = (lbl \, b) \sqcup l$\\
          and $while_i$ is the next while block label name}
  \trule{IF-STM}
        {\argpart {\tk{if} \tk ( e \tk ) S, lbl} {L} {lbl'} }
        {\argpart {S_C, lbl[if_i \mapsto l, b \mapsto b']} {L} {lbl''} \; \argpart {S, lbl''} {L} {lbl'} }
        {where $lbl \vdash e \rightarrow_E l$\\
          and $b' = (lbl \, b) \sqcup l$\\
          and $if_i$ is the next if block label name}
  \trule{IF-ELSE-STM}
        {\argpart {\tk{if} \tk ( e \tk ) S_1 \tk{else} S_2, lbl} {L} {lbl'} }
        {\argpart {S_C, lbl[if_i \mapsto l, b \mapsto b']} {L} {lbl''} \;
          \argpart {S_1, lbl''} {L} {lbl'} \;
          \argpart {S_2, lbl''} {L} {lbl_3} }
        {where $lbl \vdash e \rightarrow_E l$\\
          and $b' = (lbl \, b) \sqcup l$\\
          and $if_i$ is the next if block label name}
\end{trules}

\subsubsection{Declassify expression}

\begin{trules}
  \trule{DEC-EXPL}
        {\argpart {\tk{<|} e \tk , l \tk{|>}, lbl} {L} {lbl'} }
        {\argpart {e_d, lbl[dec_i \mapsto l]} {L} {lbl'} }
        {where $dec_i$ is the next declassify expression label name}
  \trule{DEC-IMPL}
        {\argpart {\tk{<|} e \tk{|>}, lbl} {L} {lbl'} }
        {\argpart {e_d, lbl[dec_i \mapsto \vlbl{dec_i}]} {L} {lbl'} }
        {where $dec_i$ is the next declassify expression label name}
\end{trules}


\input{algorithms/inference.tex}
